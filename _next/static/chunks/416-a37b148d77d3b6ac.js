"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[416],{31886:(e,t,r)=>{r.d(t,{G1:()=>f,H$:()=>o,Kw:()=>m,U1:()=>A,VG:()=>v,_1:()=>E,fP:()=>h,ls:()=>w,oG:()=>d,tP:()=>g,uU:()=>p,v3:()=>y,zk:()=>u});var a=r(23464);let o="http://localhost:8000",n=new Map;try{let e=localStorage.getItem("analyticsCache");if(e){let t=JSON.parse(e);Object.entries(t).forEach(e=>{let[t,r]=e;n.set(t,r)}),console.log("Loaded analytics cache from localStorage")}}catch(e){console.error("Error loading analytics cache from localStorage:",e),localStorage.removeItem("analyticsCache")}let s=()=>{if(n.size>0){let e={};n.forEach((t,r)=>{e[r]=t}),localStorage.setItem("analyticsCache",JSON.stringify(e))}},i=a.A.create({baseURL:o,headers:{"Content-Type":"application/json"},timeout:3e4,withCredentials:!1}),c=e=>{if(a.A.isCancel(e))return console.log("Request cancelled:",e.message),null;if("ECONNABORTED"===e.code)throw console.error("Request timeout:",e),Error("Connection to the server timed out. Please try again later.");if(e.response){console.error("API error response:",e.response.data||{});let t=e.response.data&&"object"==typeof e.response.data&&e.response.data.detail||e.response.data&&"string"==typeof e.response.data&&e.response.data||"Status code: ".concat(e.response.status);throw Error("Server error: ".concat(t))}if(e.request)throw console.error("No response received:",e.request),Error("No response from server. Please check if the API is running.");throw console.error("Error setting up request:",e.message),e},l=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;try{return await e()}catch(a){if(0===t)throw a;return await new Promise(e=>setTimeout(e,r)),l(e,t-1,2*r)}},d=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=new URLSearchParams;void 0!==e.skip&&r.append("skip",String(e.skip)),void 0!==e.limit&&r.append("limit",String(e.limit)),e.search&&r.append("search",e.search),e.state&&"ALL"!==e.state&&r.append("state",e.state),e.status&&"ALL"!==e.status&&r.append("status",e.status),e.sort_by&&r.append("sort_by",e.sort_by),e.sort_dir&&r.append("sort_dir",e.sort_dir);let o=r.toString();return l(async()=>{try{let e=await i.get("/devices".concat(o?"?"+o:""),{cancelToken:t,timeout:3e4});if(503===e.status)throw Error("Server is still initializing. Please try again in a few seconds.");if(e.data){if(Array.isArray(e.data))return console.log("Received array response from /devices endpoint"),e.data;else if(e.data&&"object"==typeof e.data)if(Array.isArray(e.data.devices)&&"number"==typeof e.data.total_count)return e.data;else{console.error("Unexpected response structure from /devices:",e.data);let t=Object.entries(e.data).find(e=>{let[t,r]=e;return Array.isArray(r)});if(t){let[e,r]=t;return console.log("Using ".concat(e," as devices array from response")),{devices:r,total_count:r.length}}}}throw Error("Received invalid data structure from device list API.")}catch(t){if(a.A.isCancel(t))return console.log("Request cancelled:",t.message),null;if(a.A.isAxiosError(t)){var e;if((null==(e=t.response)?void 0:e.status)===503)throw Error("Server is still initializing. Please try again in a few seconds.");if("ECONNABORTED"===t.code)throw console.error("Device list request timed out:",t),Error("Loading devices is taking longer than expected. Retrying with increased timeout...")}throw console.error("Error fetching devices:",t),t}},3,2e3)},u=async e=>{try{if(e)return(await i.get("/devices/".concat(e))).data;{let e=(await i.get("/devices")).data;return await Promise.all(e.map(async e=>{try{return(await i.get("/devices/".concat(e))).data}catch(t){return console.error("Failed to fetch history for device ".concat(e,":"),t),{dsn:e,activities:[]}}}))}}catch(t){throw console.error("Error fetching device history for ".concat(e,":"),t),t}},h=async e=>{let t=new FormData;t.append("file",e);try{return(await i.post("/upload",t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(e){return c(e)}},y=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o="".concat(e,"?").concat(new URLSearchParams(t).toString()),c=n.get(o);if(c&&Date.now()-c.timestamp<18e5)return console.log("Using cached data for ".concat(e)),c.data;let d=await S();if((null==d?void 0:d.status)==="PROCESSING")throw Error("Analytics data is still being processed. Please try again in a few seconds.");return l(async()=>{try{console.log("Fetching fresh data for ".concat(e));let a=await i.get("/analytics/".concat(e),{params:t,cancelToken:r,timeout:6e4});if(503===a.status)throw Error("Server is still initializing. Please try again in a few seconds.");return n.set(o,{data:a.data,timestamp:Date.now()}),s(),a.data}catch(t){if(a.A.isCancel(t))return console.log("Request cancelled:",t.message),null;throw console.error("Failed to fetch analytics data for ".concat(e,":"),t),t}},5,3e3)},g=async e=>{try{return await i.get("/analytics/summary",{cancelToken:e})}catch(e){throw console.error("Error fetching analytics summary:",e),e}},f=async e=>{try{return await i.get("/analytics/state-distribution",{cancelToken:e})}catch(e){throw console.error("Error fetching state distribution:",e),e}},p=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1?arguments[1]:void 0;try{return await i.get("/analytics/state-transitions",{params:{limit:e},cancelToken:t})}catch(e){throw console.error("Error fetching state transitions:",e),e}},w=async e=>{try{return await i.get("/analytics/activity-timeline",{cancelToken:e})}catch(e){throw console.error("Error fetching activity timeline:",e),e}},m=async e=>{try{return await i.get("/analytics/state-duration",{cancelToken:e})}catch(e){throw console.error("Error fetching state duration:",e),e}},v=async e=>{try{return await i.get("/analytics/journey-funnel",{cancelToken:e})}catch(e){throw console.error("Error fetching journey funnel:",e),e}},E=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;try{return await i.get("/analytics/device-anomalies-summary",{params:{limit:e},cancelToken:t})}catch(e){throw console.error("Error fetching device anomalies summary:",e),e}},A=async e=>{try{return await i.get("/analytics/transition-heatmap",{cancelToken:e})}catch(e){throw console.error("Error fetching transition heatmap:",e),e}},S=async function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{return(await i.get("/status")).data}catch(e){return{status:"complete",error:null}}}},53999:(e,t,r)=>{r.d(t,{cn:()=>n});var a=r(52596),o=r(39688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.QP)((0,a.$)(t))}}}]);