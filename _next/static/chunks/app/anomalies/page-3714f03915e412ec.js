(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[376],{6101:(e,t,r)=>{"use strict";r.d(t,{s:()=>n,t:()=>s});var a=r(12115);function i(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function s(...e){return t=>{let r=!1,a=e.map(e=>{let a=i(e,t);return r||"function"!=typeof a||(r=!0),a});if(r)return()=>{for(let t=0;t<a.length;t++){let r=a[t];"function"==typeof r?r():i(e[t],null)}}}}function n(...e){return a.useCallback(s(...e),e)}},11870:(e,t,r)=>{Promise.resolve().then(r.bind(r,12763))},12763:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var a=r(95155),i=r(12115),s=r(88482),n=r(1243),l=r(31886),d=r(6874),c=r.n(d),o=r(97168),u=r(23337);function m(){let e=Array.from({length:5},(e,t)=>t);return(0,a.jsxs)("div",{className:"container mx-auto py-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"h-8 w-32 animate-pulse bg-gradient-to-r from-gray-200 via-gray-300 to-gray-200 bg-[length:400%_100%] animate-shimmer rounded"}),(0,a.jsx)("div",{className:"h-5 w-36 animate-pulse bg-gradient-to-r from-gray-200 via-gray-300 to-gray-200 bg-[length:400%_100%] animate-shimmer rounded"})]}),(0,a.jsx)("div",{className:"grid gap-4",children:e.map(e=>(0,a.jsx)(s.Zp,{children:(0,a.jsx)(s.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"space-y-3 flex-grow",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"h-4 w-4 rounded-full animate-pulse bg-gradient-to-r from-gray-200 via-gray-300 to-gray-200 bg-[length:400%_100%] animate-shimmer"}),(0,a.jsx)(u.NZ,{width:"40%",className:"h-5"})]}),(0,a.jsx)(u.NZ,{width:"85%",className:"h-4"}),(0,a.jsx)(u.NZ,{width:"60%",className:"h-3"})]}),(0,a.jsx)("div",{className:"h-9 w-24 ml-4 animate-pulse bg-gradient-to-r from-gray-200 via-gray-300 to-gray-200 bg-[length:400%_100%] animate-shimmer rounded-md"})]})})},e))})]})}function p(){let[e,t]=(0,i.useState)(!0),[r,d]=(0,i.useState)(null),[u,p]=(0,i.useState)([]);return((0,i.useEffect)(()=>{(async()=>{try{t(!0);let e=await (0,l.oG)(),r=[];if(e&&Array.isArray(e))r=await Promise.all(e.map(async e=>{try{return await (0,l.zk)(e.dsn)}catch(t){return console.error("Failed to fetch history for device ".concat(e.dsn,":"),t),{dsn:e.dsn,activities:[]}}}));else if(e&&e.devices&&Array.isArray(e.devices))r=await Promise.all(e.devices.map(async e=>{try{return await (0,l.zk)(e.dsn)}catch(t){return console.error("Failed to fetch history for device ".concat(e.dsn,":"),t),{dsn:e.dsn,activities:[]}}}));else throw Error("Invalid data format received from API");let a=[],i={PURCHASE_RECEIPT:["MIS_INWARD","OUTWARD_MIS","KIF_REPORT"],MIS_INWARD:["OUTWARD_MIS","KIF_REPORT"],IRC_TO_WH_INWARD:["OUTWARD_MIS","KIF_REPORT"],BANK_TO_WH_INWARD:["OUTWARD_MIS","KIF_REPORT"],ERC_TO_WH_INWARD:["OUTWARD_MIS","KIF_REPORT"],FACTORY_TO_WH_INWARD:["OUTWARD_MIS"],OUTWARD_MIS:["MIS_INWARD","STOCK_TRANSFER","CALL_CLOSED","FACTORY_MASTER"],WH_TO_MERCHANT_DISPATCH:["CALL_CLOSED"],WH_TO_ERC_DISPATCH:["ERC_TO_WH_INWARD"],WH_TO_SD_DISPATCH:["SD_TO_WH_INWARD"],WH_TO_BANK_DISPATCH:["BANK_TO_WH_INWARD"],KIF_REPORT:["FACTORY_MASTER"],FACTORY_MASTER:["IRC_TO_FACTORY_INWARD","WH_TO_ERC_DISPATCH"],FACTORY_TO_IRC_DISPATCH:["IRC_TO_FACTORY_INWARD","IRC_TO_WH_INWARD"],STOCK_TRANSFER:["CALL_CLOSED"],CALL_CLOSED:["STOCK_TRANSFER","MIS_INWARD"]},s={PURCHASE_RECEIPT:7,MIS_INWARD:7,KIF_REPORT:10,FACTORY_MASTER:14,OUTWARD_MIS:3,STOCK_TRANSFER:5,CALL_CLOSED:3,default:7};r.forEach(e=>{if(!e||!e.activities||0===e.activities.length)return;let t=[...e.activities].sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime());for(let r=1;r<t.length;r++){let s=t[r-1].activity_type,n=t[r].activity_type;s&&n&&s in i&&!i[s].includes(n)&&a.push({deviceId:e.dsn,type:"Invalid State Transition",description:"Invalid transition from ".concat(s," to ").concat(n),timestamp:t[r].timestamp})}for(let r=0;r<t.length-1;r++){let i=t[r],n=t[r+1],l=i.activity_type;if(!l)continue;let d=new Date(i.timestamp),c=(new Date(n.timestamp).getTime()-d.getTime())/864e5,o=s[l]||s.default;if(c>o){a.push({deviceId:e.dsn,type:"Excessive Dwell Time",description:"Device stayed in ".concat(l," state for ").concat(Math.round(c)," days (max ").concat(o,")"),timestamp:n.timestamp});break}}if(t.length>0){let r=t[t.length-1],i=r.activity_type;if(i){let t=new Date,n=new Date(r.timestamp),l=(t.getTime()-n.getTime())/864e5,d=s[i]||s.default;l>d&&a.push({deviceId:e.dsn,type:"Stalled Device",description:"Device stuck in ".concat(i," state for ").concat(Math.round(l)," days"),timestamp:r.timestamp})}}let r=t.filter(e=>"WH_TO_ERC_DISPATCH"===e.activity_type||"KIF_REPORT"===e.activity_type||"FACTORY_TO_IRC_DISPATCH"===e.activity_type);r.length>=2&&a.push({deviceId:e.dsn,type:"Multiple Repairs",description:"Device has been sent for repair ".concat(r.length," times"),timestamp:r[r.length-1].timestamp})}),p(a),d(null)}catch(e){console.error("Error fetching data:",e),d(e.message||"Failed to fetch device data")}finally{t(!1)}})()},[]),e)?(0,a.jsx)(m,{}):r?(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)(s.Zp,{className:"border-destructive",children:(0,a.jsxs)(s.aR,{children:[(0,a.jsx)(s.ZB,{children:"Error"}),(0,a.jsx)(s.BT,{children:r})]})})}):(0,a.jsxs)("div",{className:"container mx-auto py-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Anomalies"}),(0,a.jsxs)("div",{className:"text-sm text-muted-foreground",children:[u.length," anomalies detected"]})]}),(0,a.jsx)("div",{className:"grid gap-4",children:0===u.length?(0,a.jsx)(s.Zp,{children:(0,a.jsx)(s.Wu,{className:"p-6 text-center",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"No anomalies detected"})})}):u.map((e,t)=>(0,a.jsx)(s.Zp,{className:"border-destructive",children:(0,a.jsx)(s.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n.A,{className:"h-4 w-4 text-destructive"}),(0,a.jsx)("h3",{className:"font-semibold",children:e.type})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Detected on ",new Date(e.timestamp).toLocaleString()]})]}),(0,a.jsx)(c(),{href:"/devices/".concat(e.deviceId),children:(0,a.jsx)(o.$,{variant:"outline",size:"sm",children:"View Device"})})]})})},t))})]})}},23337:(e,t,r)=>{"use strict";r.d(t,{NZ:()=>s});var a=r(95155);r(12115);var i=r(53999);function s(e){let{className:t,width:r}=e;return(0,a.jsx)("div",{className:(0,i.cn)("animate-pulse bg-gradient-to-r from-gray-200 via-gray-300 to-gray-200 bg-[length:400%_100%] animate-shimmer rounded h-4",t),style:{width:r||"100%"}})}},88482:(e,t,r)=>{"use strict";r.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>l,Zp:()=>s,aR:()=>n});var a=r(95155);r(12115);var i=r(53999);function s(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,i.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...r})}function n(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,i.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...r})}function l(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,i.cn)("leading-none font-semibold",t),...r})}function d(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,i.cn)("text-muted-foreground text-sm",t),...r})}function c(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,i.cn)("px-6",t),...r})}},97168:(e,t,r)=>{"use strict";r.d(t,{$:()=>d});var a=r(95155);r(12115);var i=r(99708),s=r(74466),n=r(53999);let l=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function d(e){let{className:t,variant:r,size:s,asChild:d=!1,...c}=e,o=d?i.DX:"button";return(0,a.jsx)(o,{"data-slot":"button",className:(0,n.cn)(l({variant:r,size:s,className:t})),...c})}},99708:(e,t,r)=>{"use strict";r.d(t,{DX:()=>l,TL:()=>n});var a=r(12115),i=r(6101),s=r(95155);function n(e){let t=function(e){let t=a.forwardRef((e,t)=>{let{children:r,...s}=e;if(a.isValidElement(r)){var n;let e,l,d=(n=r,(l=(e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?n.ref:(l=(e=Object.getOwnPropertyDescriptor(n,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?n.props.ref:n.props.ref||n.ref),c=function(e,t){let r={...t};for(let a in t){let i=e[a],s=t[a];/^on[A-Z]/.test(a)?i&&s?r[a]=(...e)=>{s(...e),i(...e)}:i&&(r[a]=i):"style"===a?r[a]={...i,...s}:"className"===a&&(r[a]=[i,s].filter(Boolean).join(" "))}return{...e,...r}}(s,r.props);return r.type!==a.Fragment&&(c.ref=t?(0,i.t)(t,d):d),a.cloneElement(r,c)}return a.Children.count(r)>1?a.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),r=a.forwardRef((e,r)=>{let{children:i,...n}=e,l=a.Children.toArray(i),d=l.find(c);if(d){let e=d.props.children,i=l.map(t=>t!==d?t:a.Children.count(e)>1?a.Children.only(null):a.isValidElement(e)?e.props.children:null);return(0,s.jsx)(t,{...n,ref:r,children:a.isValidElement(e)?a.cloneElement(e,void 0,i):null})}return(0,s.jsx)(t,{...n,ref:r,children:i})});return r.displayName=`${e}.Slot`,r}var l=n("Slot"),d=Symbol("radix.slottable");function c(e){return a.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===d}}},e=>{var t=t=>e(e.s=t);e.O(0,[598,821,600,416,441,684,358],()=>t(11870)),_N_E=e.O()}]);